language: c

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "v10SlX/9SRxCSFYqvD0gUP6qMJlqpy9T7BUb8YF35+YqUUPFAQckdQBI+PZc4lwvun3G9XnY6XZXnnmAKVaK+pbh4Q+b5hh76rmQzS3vw+j/PpWtpK63h2WzARYTLr/ktH3E2EouR1Wydzsf6nsdZWHUJ0v4w7aQjzp6V+bTdFwZCrAWEFCq56wnWDo3FOYjx1YU1FG9qDEnwvU8aN0VAt3HLQwortfjdvPqG0PFgqyKqBuNcwbHsqHd0a+qkUaIXVi2oqEdLCbc18LvjpS95GxjjVsA4aP4IqfqzHm0SkprBz9nMRiGsrOmksixZvur1ZMs/wxiKLFTPh+V5ZxeKlMKPUW3P34p5BqdRbLZfX6CgI8MUjvX/PCL3ppyz5fEshi9yPi8Fzb/mCJljaPmjRylQrpq19U4r95Uq3v+IflvHAqybqjCLCwBqjhyf5vbIHq7Uc3PvNRsGR3Z7hTLsZaak2Slvx/ZylOpKGNbUhB+ZrW/hb2vRNza77NWOuXQE7eb+/dfQ0cbnq3ojgiGnBElF18jTbzJeYST9Q9kyEU3tmP5obvUlGjuRzVXPIZKj8vja9tkX3MV1Wq/ZoXCIoyizhTBJnxhidpRvdprSeZst5bxYEMw1Tb1t/Z0akxqT11lHtFD5h2b2Gm42Uip0imfpz87odHLnP8CWVMI02o="

matrix:
  include:
    - os: linux
      compiler: gcc
      env: Compiler_Version="default"
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-5
      env: Tr_Compiler_Version="-5"
    - os: linux
      compiler: gcc
      before_install:
      - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-6
        coverity_scan:
          project:
            name: "theimpossibleastronaut/rmw"
            description: "a cross-platform command-line 'trash can' utility"
          notification_email: andy400-dev@yahoo.com
          build_command_prepend: "./configure"
          build_command: "make"
          branch_pattern: master
      env: Tr_Compiler_Version="-6"
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-7
      env: Tr_Compiler_Version="-7"
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-8
      env: Tr_Compiler_Version="-8"
    - os: linux
      compiler: clang
      addons:
          apt:
            packages:
            - libncurses5-dev
      env: BUILD=linux_clang
    - os: linux
      compiler: clang
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          - sourceline: 'deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-6.0 main'
          packages:
          - clang-6.0
      env: Tr_Compiler_Version="-6.0"
    - os: osx
      osx_image: xcode9.3beta
      env: BUILD=osx_xcode9_3
    - os: osx
      osx_image: xcode9.2
      env: BUILD=osx_xcode9_2
  allow_failures:
  - os: osx

script:
  - export CXX=$CXX$Tr_Compiler_Version
  - export CC=$CC$Tr_Compiler_Version
  - ./configure --prefix=$PWD/temp-build
  - make
  - make install
  - cd test
  - ./basic.sh
  - rm -rf tmp-home
  - ./purging.sh
  - cd ..
  - make uninstall

notifications:
  slack: removetowaste:u16fiNsaMeLmg7J4WXifW3Zm
